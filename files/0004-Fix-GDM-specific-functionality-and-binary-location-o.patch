From 8e1b9d8dcf754a27d30b9119847519ee8f821c17 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Wed, 11 Mar 2020 23:04:10 +0200
Subject: [PATCH 1/1] Fix GDM specific functionality and binary location of
 passwd.

---
 panels/user-accounts/cc-user-panel.c | 12 +-----------
 panels/user-accounts/run-passwd.c    |  2 +-
 2 files changed, 2 insertions(+), 12 deletions(-)

diff --git a/panels/user-accounts/cc-user-panel.c b/panels/user-accounts/cc-user-panel.c
index c2af402a1..9597f87c2 100644
--- a/panels/user-accounts/cc-user-panel.c
+++ b/panels/user-accounts/cc-user-panel.c
@@ -62,8 +62,6 @@ struct _CcUserPanel {
         CcPanel parent_instance;
 
         ActUserManager *um;
-        GSettings *login_screen_settings;
-
         GtkBox          *accounts_box;
         GtkBox          *account_settings_box;
         GtkListBox      *account_settings_listbox;
@@ -848,11 +846,7 @@ show_user (ActUser *user, CcUserPanel *self)
         g_free (name);
 
         /* Fingerprint: show when self, local, enabled, and possible */
-        show = (act_user_get_uid (user) == getuid() &&
-                act_user_is_local_account (user) &&
-                (self->login_screen_settings &&
-                 g_settings_get_boolean (self->login_screen_settings, "enable-fingerprint-authentication")) &&
-                set_fingerprint_label (self->fingerprint_state_label));
+        show = FALSE;
         gtk_widget_set_visible (GTK_WIDGET (self->fingerprint_row), show);
 
         /* Autologin: show when local account */
@@ -1464,8 +1458,6 @@ cc_user_panel_init (CcUserPanel *self)
                                                    GTK_STYLE_PROVIDER_PRIORITY_APPLICATION);
         g_object_unref (provider);
 
-        self->login_screen_settings = settings_or_null ("org.gnome.login-screen");
-
         self->avatar_chooser = cc_avatar_chooser_new (GTK_WIDGET (self->user_icon_button));
         setup_main_window (self);
 }
@@ -1475,8 +1467,6 @@ cc_user_panel_dispose (GObject *object)
 {
         CcUserPanel *self = CC_USER_PANEL (object);
 
-        g_clear_object (&self->login_screen_settings);
-
         g_clear_pointer ((GtkWidget **)&self->language_chooser, gtk_widget_destroy);
         g_clear_object (&self->permission);
         G_OBJECT_CLASS (cc_user_panel_parent_class)->dispose (object);
diff --git a/panels/user-accounts/run-passwd.c b/panels/user-accounts/run-passwd.c
index 19934f186..e5a7fa145 100644
--- a/panels/user-accounts/run-passwd.c
+++ b/panels/user-accounts/run-passwd.c
@@ -150,7 +150,7 @@ spawn_passwd (PasswdHandler *passwd_handler, GError **error)
         gchar  **envp;
         gint    my_stdin, my_stdout, my_stderr;
 
-        argv[0] = "/usr/bin/passwd";    /* Is it safe to rely on a hard-coded path? */
+        argv[0] = "/bin/passwd";    /* Is it safe to rely on a hard-coded path? Josh: No, no it isn't. */
         argv[1] = NULL;
 
         envp = g_get_environ ();
-- 
2.25.1

