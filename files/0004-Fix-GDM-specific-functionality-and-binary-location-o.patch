From f817bea71ea361614c393ae6b3a77952004a955b Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@stroblindustries.com>
Date: Sun, 22 Apr 2018 23:14:52 +0300
Subject: [PATCH 4/4] Fix GDM specific functionality and binary location of
 passwd.

---
 panels/user-accounts/run-passwd.c    |  2 +-
 panels/user-accounts/um-user-panel.c | 10 +---------
 2 files changed, 2 insertions(+), 10 deletions(-)

diff --git a/panels/user-accounts/run-passwd.c b/panels/user-accounts/run-passwd.c
index 00239ce0f..52154f14c 100644
--- a/panels/user-accounts/run-passwd.c
+++ b/panels/user-accounts/run-passwd.c
@@ -150,7 +150,7 @@ spawn_passwd (PasswdHandler *passwd_handler, GError **error)
         gchar  **envp;
         gint    my_stdin, my_stdout, my_stderr;
 
-        argv[0] = "/usr/bin/passwd";    /* Is it safe to rely on a hard-coded path? */
+        argv[0] = "/bin/passwd";    /* Is it safe to rely on a hard-coded path? Josh: No, no it isn't. */
         argv[1] = NULL;
 
         envp = g_get_environ ();
diff --git a/panels/user-accounts/um-user-panel.c b/panels/user-accounts/um-user-panel.c
index 15fe0c864..c19ef3e98 100644
--- a/panels/user-accounts/um-user-panel.c
+++ b/panels/user-accounts/um-user-panel.c
@@ -67,7 +67,6 @@ struct _CcUserPanelPrivate {
         GCancellable  *cancellable;
         GtkBuilder *builder;
         GtkWidget *notification;
-        GSettings *login_screen_settings;
 
         GtkWidget *headerbar_buttons;
         GtkWidget *stack;
@@ -858,11 +857,7 @@ show_user (ActUser *user, CcUserPanelPrivate *d)
         /* Fingerprint: show when self, local, enabled, and possible */
         widget = get_widget (d, "account-fingerprint-button");
         label = get_widget (d, "account-fingerprint-label");
-        show = (act_user_get_uid (user) == getuid() &&
-                act_user_is_local_account (user) &&
-                (d->login_screen_settings &&
-                 g_settings_get_boolean (d->login_screen_settings, "enable-fingerprint-authentication")) &&
-                set_fingerprint_label (widget));
+        show = FALSE;
         gtk_widget_set_visible (label, show);
         gtk_widget_set_visible (widget, show);
 
@@ -1463,7 +1458,6 @@ cc_user_panel_init (CcUserPanel *self)
 
         d->headerbar_buttons = get_widget (d, "headerbar-buttons");
         d->stack = get_widget (d, "stack");
-        d->login_screen_settings = settings_or_null ("org.gnome.login-screen");
 
         d->password_dialog = um_password_dialog_new ();
         button = get_widget (d, "user-icon-button");
@@ -1482,8 +1476,6 @@ cc_user_panel_dispose (GObject *object)
         g_cancellable_cancel (priv->cancellable);
         g_clear_object (&priv->cancellable);
 
-        g_clear_object (&priv->login_screen_settings);
-
         if (priv->um) {
                 g_signal_handlers_disconnect_by_data (priv->um, priv);
                 priv->um = NULL;
-- 
2.16.3

