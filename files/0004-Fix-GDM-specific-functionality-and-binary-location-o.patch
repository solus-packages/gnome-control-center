From 4b8f08563ceb8da4b7f1435b2e43eb5e37fe02b3 Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Tue, 14 Jul 2020 16:24:10 +0300
Subject: [PATCH 1/1] Fix GDM specific functionality and binary location of
 passwd.

---
 panels/user-accounts/cc-user-panel.c | 11 +----------
 panels/user-accounts/run-passwd.c    |  2 +-
 2 files changed, 2 insertions(+), 11 deletions(-)

diff --git a/panels/user-accounts/cc-user-panel.c b/panels/user-accounts/cc-user-panel.c
index 3afe2b0..998baf3 100644
--- a/panels/user-accounts/cc-user-panel.c
+++ b/panels/user-accounts/cc-user-panel.c
@@ -62,7 +62,6 @@ struct _CcUserPanel {
         CcPanel parent_instance;
 
         ActUserManager *um;
-        GSettings *login_screen_settings;
 
         GtkBox          *accounts_box;
         GtkBox          *account_settings_box;
@@ -850,11 +849,7 @@ show_user (ActUser *user, CcUserPanel *self)
         g_free (name);
 
         /* Fingerprint: show when self, local, enabled, and possible */
-        show = (act_user_get_uid (user) == getuid() &&
-                act_user_is_local_account (user) &&
-                (self->login_screen_settings &&
-                 g_settings_get_boolean (self->login_screen_settings,
-                                         "enable-fingerprint-authentication")));
+        show = FALSE;
 
         if (!self->needs_fingerprint_update) {
                 gtk_widget_set_visible (GTK_WIDGET (self->fingerprint_row), show);
@@ -1492,8 +1487,6 @@ cc_user_panel_init (CcUserPanel *self)
                                                    GTK_STYLE_PROVIDER_PRIORITY_APPLICATION);
         g_object_unref (provider);
 
-        self->login_screen_settings = settings_or_null ("org.gnome.login-screen");
-
         self->avatar_chooser = cc_avatar_chooser_new (GTK_WIDGET (self->user_icon_button));
         setup_main_window (self);
 }
@@ -1505,8 +1498,6 @@ cc_user_panel_dispose (GObject *object)
 
         g_clear_object (&self->selected_user);
 
-        g_clear_object (&self->login_screen_settings);
-
         g_cancellable_cancel (self->fingerprint_cancellable);
         g_clear_object (&self->fingerprint_cancellable);
 
diff --git a/panels/user-accounts/run-passwd.c b/panels/user-accounts/run-passwd.c
index 19934f1..e5a7fa1 100644
--- a/panels/user-accounts/run-passwd.c
+++ b/panels/user-accounts/run-passwd.c
@@ -150,7 +150,7 @@ spawn_passwd (PasswdHandler *passwd_handler, GError **error)
         gchar  **envp;
         gint    my_stdin, my_stdout, my_stderr;
 
-        argv[0] = "/usr/bin/passwd";    /* Is it safe to rely on a hard-coded path? */
+        argv[0] = "/bin/passwd";    /* Is it safe to rely on a hard-coded path? Josh: No, no it isn't. */
         argv[1] = NULL;
 
         envp = g_get_environ ();
-- 
2.27.0

